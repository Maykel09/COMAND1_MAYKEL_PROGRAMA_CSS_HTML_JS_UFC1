<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para Maddy</title>
    <style>
        :root {
            --color-pink-primary: #ff1493;
            --color-pink-light: #ff69b4;
            --color-pink-accent: #ffb6c1;
            --color-purple-dark: #8b008b;
            --color-purple-light: #4b0082;
            --color-white: #fff;
            --color-black: #000;
        }

        body {
            margin: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: var(--color-black);
            text-align: center;
            overflow: hidden;
            transition: background 1s ease;
        }

        /* Fondo animado */
        body.cambiar-fondo {
            animation: fondoColores 10s infinite alternate;
        }
        @keyframes fondoColores {
            0% { background: #ff1493; }
            25% { background: #ff69b4; }
            50% { background: #845ec2; }
            75% { background: #00c9a7; }
            100% { background: #f9f871; }
        }

        /* Contenedor principal */
        .full-screen-container {
            position: absolute;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .contenido {
            background: linear-gradient(to top right, #ffe0f0, #fff8fb);
            color: var(--color-purple-dark);
            padding: 40px;
            z-index: 2;
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
            transition: opacity 1s ease, transform 1s ease;
        }
        .contenido.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        /* Texto animado */
        #tituloAnimado {
            font-size: clamp(30px, 8vw, 60px);
            white-space: pre;
            min-height: 80px;
        }
        .linea {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 1s ease, transform 1s ease;
            font-size: clamp(16px, 4vw, 24px);
            margin-top: 10px;
            max-width: 700px;
        }
        .linea.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Botones */
        .boton {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 20px;
            background-color: var(--color-pink-light);
            border: none;
            border-radius: 20px;
            color: var(--color-white);
            cursor: pointer;
            transition: 0.3s;
            animation: pulse 1.5s infinite;
        }
        .boton:hover { background-color: var(--color-pink-primary); }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        img {
            max-width: 300px;
            margin-top: 20px;
            border-radius: 20px;
            box-shadow: 0 0 20px var(--color-pink-accent);
            opacity: 0;
            transform: translateY(20px);
            transition: 1s ease;
        }
        img.show { opacity: 1; transform: translateY(0); }

        .footer {
            margin-top: 40px;
            font-size: 18px;
            color: var(--color-purple-light);
            opacity: 0;
            transform: translateY(20px);
            transition: 1s ease;
        }
        .footer.show { opacity: 1; transform: translateY(0); }

        .portada {
            background: linear-gradient(to top right, var(--color-pink-accent), #ffc0cb);
            z-index: 3;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }
        .portada.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .portada h1 {
            font-size: clamp(30px, 10vw, 48px);
            color: var(--color-purple-dark);
        }

        #contadorFecha {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(40px, 10vw, 100px);
            font-weight: bold;
            color: var(--color-pink-primary);
            user-select: none;
            z-index: 10;
            opacity: 1;
            transition: opacity 1s ease;
        }
        @keyframes pop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        /* Estilo especial ES HOY :) */
        #contadorFecha.es-hoy {
            color: #00ffcc;
            font-size: clamp(50px, 12vw, 120px);
            text-shadow: 0 0 20px #fff, 0 0 40px #0ff;
        }

        canvas#fuegos {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--color-black);
            display: none;
            z-index: 5;
        }

        /* Lluvia */
        #lluvia {
            pointer-events: none;
            overflow: hidden;
            z-index: 4;
            background: transparent;
            display: none;
        }
        .texto-lluvia {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            user-select: none;
            animation-name: caer;
            animation-timing-function: linear;
            animation-iteration-count: 1;
            pointer-events: none;
            opacity: 1;
        }
        @keyframes caer {
            0% { top: -30px; opacity: 1; }
            90% { opacity: 1; }
            100% { top: 110vh; opacity: 0; }
        }

        /* Globos */
        .balloon {
            position: absolute;
            width: 60px;
            height: 80px;
            border-radius: 50%;
            animation: float 6s linear infinite;
            opacity: 0.8;
        }
        .balloon::after {
            content: "";
            position: absolute;
            width: 2px;
            height: 40px;
            background: #aaa;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
        }
        @keyframes float {
            0% { bottom: -100px; transform: translateX(0); }
            100% { bottom: 110%; transform: translateX(-20px); }
        }
        .b1 { left: 10%; background-color: #ff6f91; animation-delay: 0s; }
        .b2 { left: 30%; background-color: #ffc75f; animation-delay: 2s; }
        .b3 { left: 50%; background-color: #845ec2; animation-delay: 4s; }
        .b4 { left: 70%; background-color: #00c9a7; animation-delay: 1s; }
        .b5 { left: 90%; background-color: #f9f871; animation-delay: 3s; }
    </style>
</head>
<body>
    <div id="contadorFecha"></div>
    <canvas id="fuegos"></canvas>
    <div id="lluvia" class="full-screen-container"></div>

    <div class="portada full-screen-container" id="portada">
        <h1>üíå Para Maddy, con cari√±o</h1>
        <button class="boton" onclick="abrirCarta()">Abrir carta</button>
    </div>

    <div class="contenido full-screen-container" id="contenido">
        <div class="balloon b1"></div>
        <div class="balloon b2"></div>
        <div class="balloon b3"></div>
        <div class="balloon b4"></div>
        <div class="balloon b5"></div>
        <h1 id="tituloAnimado"></h1>
        <div class="linea" id="l1">Hoy celebramos a una persona muy especial üíñ</div>
        <div class="linea" id="l2">Espero que hoy tengas un gran d√≠a, lleno de buenos momentos y rodeada de la gente que te quiere.</div>
        <div class="linea" id="l3">Te mereces lo mejor en este nuevo a√±o de vida.</div>
        <div class="linea" id="l4">¬°A seguir cumpliendo metas y disfrutando cada momento! üí´</div>
        <img id="imagen" src="https://i.pinimg.com/736x/58/c7/ae/58c7ae3e6d438584dad7a5d06bf0c543.jpg" alt="Torta de cumplea√±os decorada con velas" />
        <div class="footer" id="firma">
            Con todo mi cari√±o,<br />üíå
        </div>
        <audio id="musica" loop>
            <source src="https://cdn.pixabay.com/download/audio/2025/04/30/audio_9834479b67.mp3?filename=happy-birthday-334876.mp3" type="audio/mpeg" />
            Tu navegador no soporta audio HTML5.
        </audio>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const D = document;
            const $ = id => D.getElementById(id);

            const contadorFechaDiv = $('contadorFecha');
            const portada = $('portada');
            const contenido = $('contenido');
            const lluviaContainer = $('lluvia');
            const canvas = $('fuegos');
            const ctx = canvas.getContext('2d');
            let lluviaInterval;

            const FECHA_CUMPLEANOS = '26/08/2025';
            const TITULO_CARTA = "üéÇ ¬°Feliz Cumplea√±os Maddy! üéâ";
            const LINEAS = ['l1', 'l2', 'l3', 'l4'];
            const TEXTO_LLUVIA = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è";
            const COLORES_LLUVIA = ['#ff1493', '#ff69b4', '#ffc0cb', '#ff6f91', '#f9f871', '#00c9a7', '#845ec2'];
            const explosionSounds = {
                'short': new Audio('https://cdn.pixabay.com/audio/2022/10/24/audio_3327124976451a5c60e4c62c3cf8e3e4_sounds_33457.mp3'),
                'long': new Audio('https://cdn.pixabay.com/audio/2022/10/24/audio_3327124976451a5c60e4c62c3cf8e3e4_sounds_33457.mp3')
            };

            const resizeEffects = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };
            window.addEventListener('resize', resizeEffects);
            resizeEffects();

            class Firework {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = canvas.height;
                    this.targetY = Math.random() * (canvas.height / 2);
                    this.color = `hsl(${Math.random() * 360},100%,50%)`;
                    this.particles = [];
                    this.done = false;
                }
                update() {
                    this.y -= 5;
                    if (this.y <= this.targetY) {
                        this.explode();
                        this.done = true;
                    }
                }
                explode() {
                    const PARTICLES_COUNT = window.innerWidth <= 600 ? 40 : 60;
                    for (let i = 0; i < PARTICLES_COUNT; i++) {
                        this.particles.push(new Particle(this.x, this.y, this.color));
                    }
                    const sound = Math.random() > 0.5 ? explosionSounds.short : explosionSounds.long;
                    sound.currentTime = 0;
                    sound.play().catch(() => {});
                }
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, 4, 4);
                }
            }

            class Particle {
                constructor(x, y, color) {
                    this.x = x; this.y = y;
                    this.vx = (Math.random() - 0.5) * 4;
                    this.vy = (Math.random() - 0.5) * 4;
                    this.alpha = 1;
                    this.color = color;
                }
                update() {
                    this.x += this.vx; this.y += this.vy;
                    this.vy += 0.05;
                    this.alpha -= 0.0008;
                }
                draw() {
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, 2, 2);
                    ctx.globalAlpha = 1;
                }
            }

            let fireworks = [];
            function animateFireworks() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (Math.random() < 0.05) fireworks.push(new Firework());
                fireworks.forEach((fw, i) => {
                    if (!fw.done) { fw.update(); fw.draw(); }
                    fw.particles.forEach((p, pi) => {
                        p.update(); p.draw();
                        if (p.alpha <= 0) fw.particles.splice(pi, 1);
                    });
                    if (fw.done && fw.particles.length === 0) fireworks.splice(i, 1);
                });
                requestAnimationFrame(animateFireworks);
            }

            const iniciarLluvia = () => {
                lluviaContainer.style.display = "block";
                lluviaInterval = setInterval(() => {
                    const letra = TEXTO_LLUVIA[Math.floor(Math.random() * TEXTO_LLUVIA.length)];
                    const span = D.createElement("span");
                    span.textContent = letra;
                    span.classList.add("texto-lluvia");
                    span.style.color = COLORES_LLUVIA[Math.floor(Math.random() * COLORES_LLUVIA.length)];
                    span.style.left = Math.random() * (window.innerWidth - 20) + "px";
                    const duracion = 6000 + Math.random() * 4000;
                    span.style.animationDuration = duracion + "ms";
                    span.style.fontSize = (20 + Math.random() * 8) + "px";
                    lluviaContainer.appendChild(span);
                    setTimeout(() => { if (lluviaContainer.contains(span)) lluviaContainer.removeChild(span) }, duracion);
                }, 200);
            };

            const detenerLluvia = () => {
                clearInterval(lluviaInterval);
                lluviaContainer.innerHTML = '';
                lluviaContainer.style.display = 'none';
            };

            const animarContador = (numeros) => {
                return new Promise(resolve => {
                    let index = 0;
                    const mostrar = () => {
                        if (index < numeros.length) {
                            contadorFechaDiv.textContent = numeros[index];
                            contadorFechaDiv.style.animation = 'pop 0.8s ease forwards';
                            index++;
                            setTimeout(mostrar, 3000);
                        } else {
                            resolve();
                        }
                    };
                    mostrar();
                });
            };

            const mostrarEsHoy = () => {
                return new Promise(resolve => {
                    contadorFechaDiv.textContent = "¬°ES HOY :)!";
                    contadorFechaDiv.classList.add("es-hoy");
                    contadorFechaDiv.style.animation = "pop 1s ease forwards";
                    document.body.classList.add("cambiar-fondo");
                    setTimeout(resolve, 7000);
                });
            };

            const mostrarFecha = () => {
                return new Promise(resolve => {
                    contadorFechaDiv.textContent = FECHA_CUMPLEANOS;
                    contadorFechaDiv.style.animation = 'pop 1s ease forwards';
                    setTimeout(resolve, 6000);
                });
            };

            const mostrarFuegos = () => {
                return new Promise(resolve => {
                    canvas.style.display = "block";
                    animateFireworks();
                    setTimeout(() => {
                        canvas.style.display = "none";
                        resolve();
                    }, 17000);
                });
            };

            const mostrarPortada = () => {
                contadorFechaDiv.style.opacity = '0';
                setTimeout(() => {
                    contadorFechaDiv.style.display = 'none';
                    portada.classList.add('visible');
                }, 1000);
            };

            const iniciarSecuencia = async () => {
                await animarContador(['3', '2', '1']);
                await mostrarEsHoy();
                await mostrarFecha();
                await mostrarFuegos();
                iniciarLluvia();
                setTimeout(mostrarPortada, 8000);
            };

            iniciarSecuencia();

            window.abrirCarta = () => {
                detenerLluvia();
                portada.style.opacity = '0';
                setTimeout(() => {
                    portada.style.display = 'none';
                    contenido.classList.add('visible');
                    escribirTitulo(TITULO_CARTA);
                    const musica = $('musica');
                    musica.currentTime = 0;
                    musica.volume = 0.9;
                    musica.play().catch(err => console.log("Autoplay bloqueado:", err));
                }, 1000);
            };

            const escribirTitulo = (texto) => {
                const elemento = $('tituloAnimado');
                elemento.textContent = "";
                let i = 0;
                const intervalo = setInterval(() => {
                    elemento.textContent += texto.charAt(i);
                    i++;
                    if (i >= texto.length) {
                        clearInterval(intervalo);
                        animarLineas();
                    }
                }, 100);
            };

            const animarLineas = () => {
                const delay = 600;
                LINEAS.forEach((id, index) => {
                    setTimeout(() => { $(id).classList.add('show'); }, delay * index);
                });
                setTimeout(() => {
                    $('imagen').classList.add("show");
                    $('firma').classList.add("show");
                }, delay * LINEAS.length + 500);
            };
        });
    </script>
</body>
</html>
